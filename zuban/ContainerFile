ARG VERSION=0.4.0

FROM ghcr.io/astral-sh/uv:python3.12-alpine AS builder
ARG VERSION
RUN uv tool install zuban==${VERSION}

FROM gcr.io/distroless/cc-debian12
ARG VERSION
LABEL org.opencontainers.image.title="Zuban LSP" \
      org.opencontainers.image.description="High-performance Python Language Server and type checker" \
      org.opencontainers.image.version="${VERSION}" \
      org.opencontainers.image.source="https://github.com/lsp-client/containers" \
      org.opencontainers.image.licenses="AGPL-3.0"

COPY --from=builder /root/.local/share/uv/tools/zuban/bin/zuban /usr/local/bin/zuban

WORKDIR /workspace
ENTRYPOINT ["/usr/local/bin/zuban", "server"]
