ARG VERSION=1.36.2
FROM docker.io/library/node:22-alpine AS builder
ARG VERSION
WORKDIR /app
RUN npm install --no-package-lock --no-audit --no-fund basedpyright@${VERSION} && \
    npm prune --production

FROM docker.io/library/node:22-alpine
ARG VERSION
LABEL org.opencontainers.image.title="BasedPyright LSP" \
      org.opencontainers.image.description="BasedPyright Language Server" \
      org.opencontainers.image.version="${VERSION}" \
      org.opencontainers.image.source="https://github.com/lsp-client/containers" \
      org.opencontainers.image.licenses="MIT"

WORKDIR /app
COPY --from=builder /app/node_modules ./node_modules
ENV PATH="/app/node_modules/.bin:${PATH}"

WORKDIR /workspace
ENTRYPOINT ["basedpyright-langserver", "--stdio"]